(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{jtYc:function(e,t,a){"use strict";a.r(t);a("T2oS");var n=a("W9HT"),r=(a("lUTK"),a("BvKs")),s=(a("IzEo"),a("bx4M")),c=(a("qVdP"),a("jsC+")),l=(a("Pwec"),a("CtXQ")),o=(a("+BJd"),a("mr32")),i=(a("2qtc"),a("kLXV")),p=a("jehZ"),u=a.n(p),m=(a("sRBo"),a("kaz8")),d=(a("14J3"),a("BMrR")),h=(a("jCWc"),a("kPKH")),E=(a("+L6B"),a("2/Rp")),v=a("eHn4"),f=a.n(v),g=a("d6i3"),y=a.n(g),b=(a("miYZ"),a("tsqr")),L=a("1l/V"),j=a.n(L),w=a("p0pE"),C=a.n(w),I=a("2Taf"),k=a.n(I),N=a("vZ4D"),x=a.n(N),F=a("l4Ni"),S=a.n(F),A=a("ujKo"),O=a.n(A),B=a("MhPg"),P=a.n(B),T=(a("OaEy"),a("2fM7")),D=(a("y8nQ"),a("Vl3Y")),M=(a("5NDa"),a("5rEg")),q=a("q1tI"),U=a.n(q),R=a("y1Nh"),V=a("MuoO"),H=a("wY1l"),J=a.n(H),z=a("XfOM"),K=a.n(z),W=a("iJd5"),Y=a("oG6R"),Z=a("+n12"),X=M.a.Search,G=D.a.Item,Q=T.a.Option,$=M.a.TextArea,_={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}},ee=function(e){function t(e){var a;return k()(this,t),(a=S()(this,O()(t).call(this,e))).onFetchList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.props.dispatch)({type:"project/projectList",payload:e})},a.onFetchItem=function(){var e=a.props,t=e.envList,n=e.dispatch;t.length||n({type:"env/envList",payload:{}})},a.onSearch=function(e){a.onFetchList({keyword:e})},a.onAdd=function(){a.setState({showAdd:!0})},a.onCancel=function(){a.setState({showAdd:!1})},a.onSubmit=function(e){a.state.searchObj;e.preventDefault(),a.props.form.validateFieldsAndScroll(function(e,t){if(!e){var n=[],r=[];t.envList.map(function(e){n.push({envId:e})}),t.devUserIds&&t.devUserIds.map(function(e){r.push({userId:e.key,userName:e.label})}),a.setState({submitLoading:!0}),a.onFetchAddPro(C()({},t,{envList:n,devUserIds:r}))}})},a.onFetchAddPro=function(){var e=j()(y.a.mark(function e(t){var n;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y.a.createProject(t);case 2:n=e.sent,a.setState({submitLoading:!1}),a.onFetchList(),n&&"01041013"==n.code&&a.onCancel(),n&&"1"==n.code&&(b.a.success("添加成功"),a.onCancel());case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onRouteTo=function(e,t){a.props.history.push({pathname:e,query:{projectId:t.projectId}})},a.onTop=function(){var e=j()(y.a.mark(function e(t){var n,r;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.orderId>0)){e.next=7;break}return e.next=3,Y.a.deleteTopProject({projectId:t.projectId});case 3:(n=e.sent)&&"1"==n.code&&(b.a.success("取消成功"),a.onFetchList()),e.next=11;break;case 7:return e.next=9,Y.a.topProject({projectId:t.projectId});case 9:(r=e.sent)&&"1"==r.code&&(b.a.success("置顶成功"),a.onFetchList());case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onFetchLBport=function(){var e=j()(y.a.mark(function e(t){var n,r;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.portLB,e.next=3,Y.a.queryDistributePort({envId:t});case 3:r=e.sent,a.setState({portLB:C()({},n,f()({},t,r.data))});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onEnvChange=function(e){var t=a.state,n=(t.portLB,t.envSelect);e.length&&e.length>n.length&&a.onFetchLBport(e[e.length-1]),a.setState({envSelect:e})},a.state={showAdd:!1,searchObj:{},submitLoading:!1,envSelect:[],portLB:{}},a}return P()(t,e),x()(t,[{key:"componentDidMount",value:function(){this.onFetchList(),this.onFetchItem()}},{key:"renderTitle",value:function(){return U.a.createElement("div",null,U.a.createElement("p",{className:K.a.marginB},"一个项目管理一系列的服务，关联一个项目负责人和多个参与人，同时关联多个",U.a.createElement(J.a,{to:"/environment"},"环境"),"用于服务的部署"),U.a.createElement(d.a,{type:"flex",justify:"space-between",align:"middle"},U.a.createElement(h.a,null,Object(Z.f)()&&U.a.createElement(E.a,{type:"primary",onClick:this.onAdd},"+ 新建项目")),U.a.createElement(h.a,null,U.a.createElement(X,{placeholder:"搜索项目",onSearch:this.onSearch}))))}},{key:"renderModal",value:function(){var e,t=this.state,a=t.showAdd,n=t.submitLoading,r=(t.portLB,this.props),s=r.userAll,c=r.envList,l=this.props.form,o=l.getFieldDecorator;l.getFieldValue;return U.a.createElement(i.a,{visible:a,width:800,title:"新建项目",onCancel:this.onCancel,onOk:this.onSubmit,confirmLoading:n},U.a.createElement(D.a,u()({},_,{onSubmit:this.onSubmit}),U.a.createElement(G,{label:"项目名"},o("projectName",{rules:[(e={required:!0,message:"请输入项目名"},f()(e,"message","请输入20位以内中文数字字母中横线的组合"),f()(e,"pattern",/^[A-Za-z0-9-\u4E00-\u9FA5]{1,20}$/),e)]})(U.a.createElement(M.a,{placeholder:"请输入项目名"}))),U.a.createElement(G,{label:"项目CODE"},o("projectCode",{rules:[{required:!0,message:"请输入项目CODE"}]})(U.a.createElement(M.a,{placeholder:"请输入项目CODE，创建后不能修改"}))),U.a.createElement(G,{label:"描述"},o("description",{rules:[{pattern:/^[\S ]{0,500}$/,message:"最多500个字符"}]})(U.a.createElement($,{placeholder:"请输入项目描述",rows:4}))),U.a.createElement(G,{label:"负责人"},o("masterUserId",{rules:[{required:!0,message:"请选择负责人"}]})(U.a.createElement(T.a,{placeholder:"请选择负责人",showSearch:!0,optionFilterProp:"children"},s&&s.rows&&s.rows.map(function(e){return U.a.createElement(Q,{value:e.userId,key:e.userId},e.realName)})))),U.a.createElement(G,{label:"参与人"},o("devUserIds",{})(U.a.createElement(T.a,{placeholder:"请选择参与人",showSearch:!0,mode:"multiple",allowClear:!0,optionFilterProp:"children",labelInValue:!0},s&&s.rows&&s.rows.map(function(e){return U.a.createElement(Q,{value:e.userId,key:e.userId},e.realName)})))),U.a.createElement(G,{label:"环境资源"},o("envList",{rules:[{required:!0,message:"至少选择一个环境资源"}]})(U.a.createElement(m.a.Group,{style:{width:"100%",lineHeight:"unset"}},U.a.createElement(d.a,{type:"flex",align:"middle"},c.map(function(e,t){return U.a.createElement(h.a,{span:11,key:e.id},U.a.createElement(m.a,{value:e.id},e.name))})))))))}},{key:"renderList",value:function(){var e=this,t=this.props.list;return U.a.createElement(q.Fragment,null,U.a.createElement(d.a,{gutter:24},t.length?t.map(function(t,a){return U.a.createElement(h.a,{key:a,md:8,sm:12},U.a.createElement(s.a,{className:"".concat(K.a.marginB," ").concat(K.a.listItem),hoverable:!0},U.a.createElement("div",{onClick:function(){return e.onRouteTo("/project/detail",t)}},U.a.createElement("div",{className:K.a.flexCenter},U.a.createElement("div",{className:K.a.itemFirst,style:{backgroundColor:W.e[t.projectId%5]}},t.projectName.charAt(0).toUpperCase()),U.a.createElement("strong",{className:K.a.textFont16},t.projectName),t.orderId>0&&U.a.createElement("div",{className:K.a.marginL10},U.a.createElement(o.a,{color:"blue"},"置顶"))),U.a.createElement(d.a,{type:"flex",className:K.a.marginT},U.a.createElement(h.a,{className:K.a.textC,span:8},U.a.createElement("p",{className:K.a.textFont16},"服务"),U.a.createElement("p",null,t.appCount)),U.a.createElement(h.a,{className:K.a.textC,span:8},U.a.createElement("p",{className:K.a.textFont16},"用户"),U.a.createElement("p",null,t.userCount)),U.a.createElement(h.a,{className:K.a.textC,span:8},U.a.createElement("p",{className:K.a.textFont16},"环境"),U.a.createElement("p",null,t.envCount))),U.a.createElement("div",{className:K.a.itemDesc},U.a.createElement("span",{className:K.a.itemDescSpan,style:{WebkitBoxOrient:"vertical"}},t.description))),U.a.createElement("div",{className:K.a.moreOprea},U.a.createElement(c.a,{overlay:e.renderMoreOpera(t,a),placement:"bottomCenter"},U.a.createElement(l.a,{type:"ellipsis",style:{fontSize:25}})))))}):U.a.createElement(h.a,{span:8},Object(Z.f)()&&U.a.createElement(E.a,{type:"dashed",className:K.a.listItem,onClick:this.onAdd},U.a.createElement(l.a,{type:"plus"}),U.a.createElement("span",null,"新建项目")))))}},{key:"renderMoreOpera",value:function(e,t){var a=this;return U.a.createElement(r.a,null,U.a.createElement(r.a.Item,{onClick:function(){a.onTop(e)}},U.a.createElement("span",null,e.orderId>0?"取消置顶":"置顶")))}},{key:"render",value:function(){var e=this.state.showAdd,t=this.props.loading;return U.a.createElement(R.PageHeaderWrapper,{content:this.renderTitle()},U.a.createElement(n.a,{spinning:t},this.renderList()),e&&this.renderModal())}}]),t}(U.a.Component);t.default=D.a.create()(Object(V.connect)(function(e){var t=e.project,a=e.loading,n=e.auth,r=e.env;return{list:t.projectList,userAll:n.userAll,envList:r.envList,loading:a.effects["project/projectList"]}})(ee))}}]);