(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"/PHi":function(e,t,a){"use strict";a.r(t);a("T2oS");var n=a("W9HT"),r=(a("Pwec"),a("CtXQ")),s=(a("2qtc"),a("kLXV")),o=a("jehZ"),c=a.n(o),i=(a("14J3"),a("BMrR")),p=(a("jCWc"),a("kPKH")),l=(a("+L6B"),a("2/Rp")),u=a("d6i3"),d=a.n(u),h=(a("miYZ"),a("tsqr")),m=a("1l/V"),f=a.n(m),v=a("p0pE"),E=a.n(v),y=a("2Taf"),L=a.n(y),j=a("vZ4D"),g=a.n(j),A=a("l4Ni"),b=a.n(A),w=a("ujKo"),k=a.n(w),C=a("MhPg"),O=a.n(C),F=(a("OaEy"),a("2fM7")),S=(a("y8nQ"),a("Vl3Y")),I=(a("5NDa"),a("5rEg")),x=a("q1tI"),D=a.n(x),T=a("y1Nh"),q=a("MuoO"),M=a("cBhy"),N=(a("iJd5"),a("Onig")),P=a("XfOM"),B=a.n(P),H=a("3a4m"),J=a.n(H),R=a("+n12"),W=I.a.Search,z=S.a.Item,V=F.a.Option,X=I.a.TextArea,Z={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}},K=function(e){function t(e){var a;return L()(this,t),(a=b()(this,k()(t).call(this,e))).onFetchList=function(){var e=a.state.searchObj;(0,a.props.dispatch)({type:"service/appList",payload:e})},a.onFetchListAdmin=function(){(0,a.props.dispatch)({type:"project/projectListAdmin",payload:{}})},a.onFetchProjectList=function(){var e=a.props,t=e.projectList,n=e.dispatch;t.length||n({type:"project/projectList"})},a.onSearch=function(e){var t=a.state.searchObj;a.setState({searchObj:E()({},t,{keyword:e})})},a.onAdd=function(){J.a.push("/service/add")},a.onCancel=function(){a.setState({showAdd:!1})},a.onSubmit=function(e){e.preventDefault(),a.props.form.validateFieldsAndScroll(function(e,t){e||a.onFetchAppCreate(t)})},a.onFetchAppCreate=function(){var e=f()(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({appCreateLoading:!0}),e.next=3,N.a.appCreate(t);case 3:n=e.sent,a.setState({appCreateLoading:!1}),n&&"1"==n.code&&(a.setState({showAdd:!1}),h.a.success("添加成功"),a.onFetchList());case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onRouteTo=function(e,t){a.props.history.push({pathname:e,query:{appId:t.id,projectId:t.projectId}})},a.onTop=function(){var e=f()(d.a.mark(function e(t){var n,r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.orderId>0)){e.next=7;break}return e.next=3,N.a.topDelete({appId:t.id});case 3:(n=e.sent)&&"1"===n.code&&(h.a.success("取消成功"),a.onFetchList()),e.next=11;break;case 7:return e.next=9,N.a.topAdd({appId:t.id});case 9:(r=e.sent)&&"1"===r.code&&(h.a.success("置顶成功"),a.onFetchList());case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.state={showAdd:!1,searchObj:{},appCreateLoading:!1},a}return O()(t,e),g()(t,[{key:"componentDidMount",value:function(){this.onFetchList(),this.onFetchListAdmin()}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.searchObj;t.searchObj!==a&&this.onFetchList()}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"service/clearData",payload:{appList:[]}})}},{key:"renderTitle",value:function(){var e=this.props.projectListAdmin;return D.a.createElement("div",null,D.a.createElement("p",{className:B.a.marginB},"一个服务对应一个完整的生命周期，拥有代码管理、编译、打包、容器镜像、测试、发布、部署、运维、监控等完整的功能"),D.a.createElement(i.a,{type:"flex",justify:"space-between",align:"middle"},D.a.createElement(p.a,null,Object(R.f)()||e.length?D.a.createElement(l.a,{type:"primary",onClick:this.onAdd},"+ 新建服务"):null),D.a.createElement(p.a,null,D.a.createElement(W,{placeholder:"搜索服务",onSearch:this.onSearch}))))}},{key:"renderModal",value:function(){var e=this.state,t=e.showAdd,a=e.appCreateLoading,n=this.props.form.getFieldDecorator,r=this.props,o=r.userAll,i=r.projectListAdmin;return D.a.createElement(s.a,{visible:t,title:"新建服务",onCancel:this.onCancel,onOk:this.onSubmit,confirmLoading:a},D.a.createElement(S.a,c()({},Z,{onSubmit:this.onSubmit}),D.a.createElement(z,{label:"服务名"},n("appName",{rules:[{required:!0,message:"服务名为20位以内中文数字字母中横线的组合",pattern:/^[a-zA-z0-9-\u4E00-\u9FA5]{1,20}$/}]})(D.a.createElement(I.a,{placeholder:"请输入服务名"}))),D.a.createElement(z,{label:"服务CODE"},n("appCode",{rules:[{required:!0,message:"CODE为20位以内数字小写字母中横线的组合",pattern:/^[a-z0-9-]{1,20}$/}]})(D.a.createElement(I.a,{placeholder:"请输入服务CODE，创建后不能修改"}))),D.a.createElement(z,{label:"服务描述"},n("description",{rules:[{message:"最多输入100个字符",validator:function(e,t,a){t.length>100?a("最多输入100个字符"):a()}}]})(D.a.createElement(X,{placeholder:"请输入描述",rows:4}))),D.a.createElement(z,{label:"所属项目"},n("projectId",{rules:[{required:!0,message:"请选择所属项目"}]})(D.a.createElement(F.a,{placeholder:"请选择所属项目",showSearch:!0,optionFilterProp:"children"},i&&i.map(function(e){return D.a.createElement(V,{value:e.id,key:e.id},e.projectName)})))),D.a.createElement(z,{label:"服务负责人"},n("leaderId",{rules:[{required:!0,message:"请选择服务负责人"}]})(D.a.createElement(F.a,{placeholder:"请选择服务负责人",showSearch:!0,optionFilterProp:"children"},o&&o.rows&&o.rows.map(function(e){return D.a.createElement(V,{value:e.userId,key:e.userId},e.realName)}))))))}},{key:"renderList",value:function(){var e=this,t=this.props,a=t.list,n=t.projectListAdmin;return D.a.createElement(x.Fragment,null,D.a.createElement(i.a,{gutter:24},a&&a.length?a.map(function(t,a){return D.a.createElement(p.a,{key:a,md:8,sm:12},D.a.createElement(M.a,{item:E()({},t,{index:a}),toTop:function(){return e.onTop(t)},onItemClick:function(){return e.onRouteTo("/service/detail",t)}}))}):D.a.createElement(p.a,{span:8},Object(R.f)()||n.length?D.a.createElement(l.a,{type:"dashed",className:B.a.listItem,onClick:this.onAdd},D.a.createElement(r.a,{type:"plus"}),D.a.createElement("span",null,"新建服务")):null)))}},{key:"render",value:function(){var e=this.state.showAdd,t=this.props.loading;return D.a.createElement(T.PageHeaderWrapper,{content:this.renderTitle()},D.a.createElement(n.a,{spinning:t},this.renderList()),e&&this.renderModal())}}]),t}(D.a.Component);t.default=S.a.create()(Object(q.connect)(function(e){var t=e.service,a=e.loading,n=e.auth,r=e.project;return{list:t.appList,userAll:n.userAll,projectList:r.projectList,projectListAdmin:r.projectListAdmin,loading:a.effects["service/appList"]}})(K))}}]);