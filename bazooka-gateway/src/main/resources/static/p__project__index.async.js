(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{jtYc:function(e,t,a){"use strict";a.r(t);a("T2oS");var n=a("W9HT"),r=(a("lUTK"),a("BvKs")),c=(a("IzEo"),a("bx4M")),o=(a("Pwec"),a("CtXQ")),l=(a("2qtc"),a("kLXV")),s=a("jehZ"),i=a.n(s),u=(a("sRBo"),a("kaz8")),p=(a("14J3"),a("BMrR")),d=(a("jCWc"),a("kPKH")),m=(a("+L6B"),a("2/Rp")),h=a("eHn4"),f=a.n(h),v=a("d6i3"),E=a.n(v),y=(a("miYZ"),a("tsqr")),g=a("1l/V"),I=a.n(g),L=a("p0pE"),b=a.n(L),w=a("2Taf"),j=a.n(w),k=a("vZ4D"),C=a.n(k),x=a("l4Ni"),F=a.n(x),N=a("ujKo"),S=a.n(N),A=a("MhPg"),P=a.n(A),D=(a("OaEy"),a("2fM7")),O=(a("y8nQ"),a("Vl3Y")),B=(a("5NDa"),a("5rEg")),T=a("q1tI"),M=a.n(T),q=a("y1Nh"),R=a("MuoO"),U=a("wY1l"),H=a.n(U),V=a("XfOM"),z=a.n(V),J=a("iJd5"),K=a("oG6R"),Y=a("+n12"),Z=B.a.Search,W=O.a.Item,X=D.a.Option,G=B.a.TextArea,Q={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}}},$=function(e){function t(e){var a;return j()(this,t),(a=F()(this,S()(t).call(this,e))).onFetchList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.props.dispatch)({type:"project/projectList",payload:e})},a.onFetchItem=function(){var e=a.props,t=e.envList,n=e.dispatch;t.length||n({type:"env/envList",payload:{}})},a.onSearch=function(e){a.onFetchList({keyword:e})},a.onAdd=function(){a.setState({showAdd:!0})},a.onCancel=function(){a.setState({showAdd:!1})},a.onSubmit=function(e){a.state.searchObj;e&&e.preventDefault(),a.props.form.validateFieldsAndScroll(function(e,t){if(!e){var n=[],r=[];t.envList.map(function(e){n.push({envId:e})}),t.devUserIds&&t.devUserIds.map(function(e){r.push({userId:e.key,userName:e.label})}),a.setState({submitLoading:!0}),a.onFetchAddPro(b()({},t,{envList:n,devUserIds:r}))}})},a.onFetchAddPro=function(){var e=I()(E.a.mark(function e(t){var n;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.a.createProject(t);case 2:n=e.sent,a.setState({submitLoading:!1}),a.onFetchList(),n&&"01041013"==n.code&&a.onCancel(),n&&"1"==n.code&&(y.a.success("添加成功"),a.onCancel());case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onRouteTo=function(e,t){a.props.history.push({pathname:e,query:{projectId:t.projectId}})},a.onTop=function(){var e=I()(E.a.mark(function e(t){var n,r;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.orderId>0)){e.next=7;break}return e.next=3,K.a.deleteTopProject({projectId:t.projectId});case 3:(n=e.sent)&&"1"==n.code&&(y.a.success("取消成功"),a.onFetchList()),e.next=11;break;case 7:return e.next=9,K.a.topProject({projectId:t.projectId});case 9:(r=e.sent)&&"1"==r.code&&(y.a.success("置顶成功"),a.onFetchList());case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onFetchLBport=function(){var e=I()(E.a.mark(function e(t){var n,r;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.portLB,e.next=3,K.a.queryDistributePort({envId:t});case 3:r=e.sent,a.setState({portLB:b()({},n,f()({},t,r.data))});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onEnvChange=function(e){var t=a.state,n=(t.portLB,t.envSelect);e.length&&e.length>n.length&&a.onFetchLBport(e[e.length-1]),a.setState({envSelect:e})},a.state={showAdd:!1,searchObj:{},submitLoading:!1,envSelect:[],portLB:{}},a}return P()(t,e),C()(t,[{key:"componentDidMount",value:function(){this.onFetchList(),this.onFetchItem()}},{key:"renderTitle",value:function(){return M.a.createElement("div",null,M.a.createElement("p",{className:z.a.marginB},"一个项目管理一系列的服务，关联一个项目负责人和多个参与人，同时关联多个",M.a.createElement(H.a,{to:"/environment"},"环境"),"用于服务的部署"),M.a.createElement(p.a,{type:"flex",justify:"space-between",align:"middle"},M.a.createElement(d.a,null,Object(Y.f)()&&M.a.createElement(m.a,{type:"primary",onClick:this.onAdd},"+ 新建项目")),M.a.createElement(d.a,null,M.a.createElement(Z,{placeholder:"搜索项目",onSearch:this.onSearch}))))}},{key:"renderModal",value:function(){var e=this.state,t=e.showAdd,a=e.submitLoading,n=(e.portLB,this.props),r=n.userAll,c=n.envList,o=this.props.form,s=o.getFieldDecorator;o.getFieldValue;return M.a.createElement(l.a,{visible:t,width:800,title:"新建项目",onCancel:this.onCancel,onOk:this.onSubmit,confirmLoading:a},M.a.createElement(O.a,i()({},Q,{onSubmit:this.onSubmit}),M.a.createElement(W,{label:"项目名"},s("projectName",{rules:[{required:!0,message:"请输入20位以内中文数字字母中横线的组合",pattern:/^[A-Za-z0-9-\u4E00-\u9FA5]{1,20}$/}]})(M.a.createElement(B.a,{placeholder:"请输入项目名"}))),M.a.createElement(W,{label:"项目CODE"},s("projectCode",{rules:[{required:!0,message:"请输入项目CODE"}]})(M.a.createElement(B.a,{placeholder:"请输入项目CODE，创建后不能修改"}))),M.a.createElement(W,{label:"描述"},s("description",{rules:[{validator:function(e,t,a){try{t.length>10?a("最多500个字符"):a()}catch(e){a()}}}]})(M.a.createElement(G,{placeholder:"请输入项目描述",rows:4}))),M.a.createElement(W,{label:"负责人"},s("masterUserId",{rules:[{required:!0,message:"请选择负责人"}]})(M.a.createElement(D.a,{placeholder:"请选择负责人",showSearch:!0,optionFilterProp:"children"},r&&r.rows&&r.rows.map(function(e){return M.a.createElement(X,{value:e.userId,key:e.userId},e.realName)})))),M.a.createElement(W,{label:"参与人"},s("devUserIds",{})(M.a.createElement(D.a,{placeholder:"请选择参与人",showSearch:!0,mode:"multiple",allowClear:!0,optionFilterProp:"children",labelInValue:!0},r&&r.rows&&r.rows.map(function(e){return M.a.createElement(X,{value:e.userId,key:e.userId},e.realName)})))),M.a.createElement(W,{label:"环境资源"},s("envList",{rules:[{required:!0,message:"至少选择一个环境资源"}]})(M.a.createElement(u.a.Group,{style:{width:"100%",lineHeight:"unset"}},M.a.createElement(p.a,{type:"flex",align:"middle"},c.map(function(e,t){return M.a.createElement(d.a,{span:11,key:e.id},M.a.createElement(u.a,{value:e.id},e.name))})))))))}},{key:"renderList",value:function(){var e=this,t=this.props.list;return M.a.createElement(T.Fragment,null,M.a.createElement(p.a,{gutter:24},t.length?t.map(function(t,a){return M.a.createElement(d.a,{key:a,md:8,sm:12},M.a.createElement(c.a,{className:"".concat(z.a.marginB," ").concat(z.a.listItem),hoverable:!0,style:{backgroundColor:J.f[t.projectId%5]}},M.a.createElement("div",{className:z.a.pushpinIcon,onClick:function(){e.onTop(t)},title:t.orderId>0?"取消置顶":"置顶"},M.a.createElement(o.a,{type:"pushpin",theme:t.orderId>0?"filled":"outlined",style:{fontSize:18}})),M.a.createElement(p.a,{onClick:function(){return e.onRouteTo("/project/detail",t)}},M.a.createElement("div",{className:z.a.flex},M.a.createElement("strong",{className:z.a.textFont16},t.projectName)),M.a.createElement("div",{className:z.a.itemDesc},M.a.createElement("span",{className:z.a.itemDescSpan},t.description)),M.a.createElement("div",{className:"".concat(z.a.flex," ").concat(z.a.itemDetailPro)},M.a.createElement("div",{className:"".concat(z.a.flex1," ").concat(z.a.itemDetailProItem)},M.a.createElement("p",{className:z.a.textFont16},"服务"),M.a.createElement("p",null,t.appCount)),M.a.createElement("div",{className:"".concat(z.a.flex1," ").concat(z.a.itemDetailProItem)},M.a.createElement("p",{className:z.a.textFont16},"用户"),M.a.createElement("p",null,t.userCount)),M.a.createElement("div",{className:"".concat(z.a.flex1," ").concat(z.a.itemDetailProItem)},M.a.createElement("p",{className:z.a.textFont16},"环境"),M.a.createElement("p",null,t.envCount))))))}):M.a.createElement(d.a,{span:8},Object(Y.f)()&&M.a.createElement(m.a,{type:"dashed",className:z.a.listItem,onClick:this.onAdd},M.a.createElement(o.a,{type:"plus"}),M.a.createElement("span",null,"新建项目")))))}},{key:"renderMoreOpera",value:function(e,t){var a=this;return M.a.createElement(r.a,null,M.a.createElement(r.a.Item,{onClick:function(){a.onTop(e)}},M.a.createElement("span",null,e.orderId>0?"取消置顶":"置顶")))}},{key:"render",value:function(){var e=this.state.showAdd,t=this.props.loading;return M.a.createElement(q.PageHeaderWrapper,{content:this.renderTitle()},M.a.createElement(n.a,{spinning:t},this.renderList()),e&&this.renderModal())}}]),t}(M.a.Component);t.default=O.a.create()(Object(R.connect)(function(e){var t=e.project,a=e.loading,n=e.auth,r=e.env;return{list:t.projectList,userAll:n.userAll,envList:r.envList,loading:a.effects["project/projectList"]}})($))}}]);